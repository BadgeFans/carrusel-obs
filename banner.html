<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Banner Bilingüe</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    width:1920px; height:350px; background:transparent; overflow:hidden;
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    display:flex; justify-content:center; align-items:center;
}

.glass-overlay {
    width:1920px; height:350px;
    background: rgba(0,0,0,0.75);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    position:relative; display:flex; justify-content:center; align-items:center;
    border-top: 1px solid rgba(255,255,255,0.15);
    border-bottom: 1px solid rgba(255,255,255,0.15);
    box-shadow: inset 0 1px 12px rgba(255,255,255,0.05), 0 8px 30px rgba(0,0,0,0.5);
}

.content-wrapper {
    width:100%; max-width:1800px; height:100%;
    display:flex; align-items:center; justify-content:space-between;
    padding:40px 60px; gap:60px; position:relative;
}

.text-col { flex:1; display:flex; flex-direction:column; gap:20px; z-index:2; }
.title { 
    font-size:42px; font-weight:bold; color:#fff; text-transform:uppercase; letter-spacing:4px; 
    text-shadow: 4px 4px 12px rgba(0,0,0,0.9); line-height:1.2;
}
.description { 
    font-size:22px; line-height:1.7; color:#fff; text-shadow: 3px 3px 10px rgba(0,0,0,0.9); max-width:750px;
}

.image-col { flex:1; display:flex; align-items:center; justify-content:center; max-width:800px; z-index:2; }
#langImage {
    width:100%; max-width:700px; height:auto; max-height:270px; border-radius:16px; 
    box-shadow: 0 12px 40px rgba(0,0,0,.6); display:none; object-fit:cover;
}

.glitch { animation: glitch .8s ease-in-out; }
@keyframes glitch {
    0% { transform: translate(0); opacity:1; }
    10% { transform: translate(-2px, 1px); }
    20% { transform: translate(2px, -2px); }
    50% { opacity: .4; filter: blur(1px); }
    60% { transform: translate(2px, 1px); opacity:.8; }
    100% { transform: translate(0); opacity:1; }
}
</style>
</head>
<body>
<div class="glass-overlay" id="glassOverlay">
    <div class="content-wrapper">
        <div class="text-col">
            <h1 class="title" id="title"></h1>
            <p class="description" id="description"></p>
        </div>
        <div class="image-col"><img id="langImage" alt=""></div>
    </div>
</div>

<script>
const config = {
    timePerLanguage: 5000,
    timePerCard: 10000,
    glitchDuration: 800
};

let items = [];
let cardIndex = 0;
let lang = 'en';
let allTimeouts = [];

function clearAllTimeouts() {
    allTimeouts.forEach(clearTimeout);
    allTimeouts = [];
}

async function loadBannerItems() {
    try {
        const response = await fetch('https://api.github.com/repos/BadgeFans/carrusel-obs/contents/content/banner');
        if (!response.ok) throw new Error('GitHub fetch failed');
        const files = await response.json();
        const mdFiles = files.filter(f => f.name.endsWith('.md'));
        const loadedItems = [];
        for (const f of mdFiles) {
            const txt = await (await fetch(f.download_url)).text();
            const item = parseFrontmatter(txt);
            if (item) loadedItems.push(item);
        }
        return loadedItems.sort((a,b) => a.order - b.order);
    } catch(e) {
        console.error('Error loading items:', e);
        return [{
            order:1,
            title:'NEW STREAM SCHEDULE',
            titleES:'NUEVO HORARIO',
            description:'Streaming Monday to Friday from 8 PM to 11 PM EST. Join us!',
            descriptionES:'Transmitiendo de lunes a viernes de 8 PM a 11 PM EST. ¡Únete!',
            titleSize:'42',
            descSize:'22',
            imageEN:'https://via.placeholder.com/700x270/555/fff?text=English',
            imageES:'https://via.placeholder.com/700x270/777/fff?text=Español'
        }];
    }
}

function parseFrontmatter(content) {
    const m = content.match(/^---\n([\s\S]*?)\n---/);
    if (!m) return null;
    const data = {};
    m[1].split('\n').forEach(line => {
        const idx = line.indexOf(':');
        if (idx === -1) return;
        const key = line.substring(0, idx).trim();
        const val = line.substring(idx + 1).trim();
        data[key] = val;
    });
    return {
        order: parseInt(data.order) || 0,
        title: data.title || '',
        titleES: data.titleES || '',
        description: data.description || '',
        descriptionES: data.descriptionES || '',
        titleSize: data.titleSize || '42',
        descSize: data.descSize || '22',
        imageEN: data.imageEN || '',
        imageES: data.imageES || ''
    };
}

function applyItem(item) {
    const t = document.getElementById('title');
    const d = document.getElementById('description');
    const img = document.getElementById('langImage');

    t.style.fontSize = (item.titleSize || '42') + 'px';
    d.style.fontSize = (item.descSize || '22') + 'px';

    if (item.imageEN || item.imageES) {
        img.style.display = 'block';
        img.src = (lang === 'en') ? (item.imageEN || item.imageES) : (item.imageES || item.imageEN);
    } else {
        img.style.display = 'none';
    }
}

function swapLanguage(item) {
    const t = document.getElementById('title');
    const d = document.getElementById('description');
    const img = document.getElementById('langImage');

    t.classList.add('glitch');
    d.classList.add('glitch');

    allTimeouts.push(setTimeout(() => {
        lang = (lang === 'en') ? 'es' : 'en';
        t.textContent = (lang === 'en') ? item.title : (item.titleES || item.title);
        d.textContent = (lang === 'en') ? item.description : (item.descriptionES || item.description);

        const nextSrc = (lang === 'en') ? (item.imageEN || item.imageES) : (item.imageES || item.imageEN);
        if (nextSrc) {
            img.style.display = 'block';
            img.src = nextSrc;
        } else {
            img.style.display = 'none';
        }
    }, config.glitchDuration / 2));

    allTimeouts.push(setTimeout(() => {
        t.classList.remove('glitch');
        d.classList.remove('glitch');
    }, config.glitchDuration));
}

function showCard(idx) {
    clearAllTimeouts();
    
    const item = items[idx];
    lang = 'en';
    
    // Limpiar imagen anterior
    const img = document.getElementById('langImage');
    img.style.display = 'none';
    img.src = '';
    
    // Aplicar nueva tarjeta
    applyItem(item);
    document.getElementById('title').textContent = item.title;
    document.getElementById('description').textContent = item.description;
    
    // Programar cambios de idioma
    let swaps = Math.floor(config.timePerCard / config.timePerLanguage);
    for (let i = 1; i < swaps; i++) {
        allTimeouts.push(setTimeout(() => swapLanguage(item), i * config.timePerLanguage));
    }
    
    // Programar siguiente tarjeta
    allTimeouts.push(setTimeout(() => {
        cardIndex = (cardIndex + 1) % items.length;
        showCard(cardIndex);
    }, config.timePerCard));
}

window.addEventListener('DOMContentLoaded', async () => {
    items = await loadBannerItems();
    if (!items.length) {
        items = [{
            order:1,
            title:'LOADING',
            titleES:'CARGANDO',
            description:'Please wait...',
            descriptionES:'Por favor espera...',
            titleSize:'42',
            descSize:'22'
        }];
    }
    showCard(0);
});
</script>
</body>
</html>
